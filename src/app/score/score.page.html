<ion-header [translucent]="true">
  <ion-toolbar style="--background: linear-gradient(135deg, #1a237e 0%, #283593 100%); box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <ion-title style="color: white; font-weight: 700; font-size: 20px; letter-spacing: 0.5px;">Cricket Scoring</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" style="--background: #f8f9fa;">
  <div style="padding: 16px;">
    
    <!-- Back Button -->
    <div style="margin-bottom: 20px;">
      <ion-button mode="ios" expand="block" 
                 class="back-btn"
                 (click)="goBack()">
        <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </ion-button>
    </div>

    <!-- Action Cards Section -->
    <div style="margin-bottom: 28px;">
      <h3 style="font-size: 14px; font-weight: 600; color: #666; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 12px 0; padding: 0 4px;">Quick Actions</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <ion-button mode="ios" expand="block" 
                   class="action-card tournament-action"
                   (click)="startNewTournament()">
          <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
            <path d="M6 9l6 6 6-6"/>
            <circle cx="12" cy="12" r="1"/>
            <circle cx="19" cy="12" r="1"/>
            <circle cx="5" cy="12" r="1"/>
          </svg>
          <div style="display: flex; flex-direction: column; align-items: flex-start;">
            <span style="font-weight: 600; font-size: 14px;">Tournament</span>
            <span style="font-size: 12px; opacity: 0.8;">New Match</span>
          </div>
        </ion-button>
        
        <ion-button mode="ios" expand="block" 
                   class="action-card friendly-action"
                   (click)="startNewFriendly()">
          <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
            <line x1="12" y1="8" x2="12" y2="16"/>
            <line x1="8" y1="12" x2="16" y2="12"/>
          </svg>
          <div style="display: flex; flex-direction: column; align-items: flex-start;">
            <span style="font-weight: 600; font-size: 14px;">Friendly</span>
            <span style="font-size: 12px; opacity: 0.8;">New Match</span>
          </div>
        </ion-button>
      </div>
    </div>

    <!-- Info Section -->
    <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 4px solid #1976d2;">
      <h3 style="color: #1976d2; font-weight: 600; font-size: 15px; margin: 0 0 8px 0;">Available Matches</h3>
      <p style="color: #666; font-size: 13px; margin: 0; line-height: 1.5;">
        View all scheduled, live, and assigned matches ready for scoring. Use the filter below to find matches quickly.
      </p>
    </div>

    <!-- Filter Section -->
    <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
      <label style="display: block; font-weight: 600; color: #333; font-size: 14px; margin-bottom: 10px;">Filter Matches</label>
      <ion-select [(ngModel)]="filterOption" interface="popover" style="width: 100%; padding: 10px 12px; border: 1px solid #e0e0e0; border-radius: 8px; background: #f5f5f5; color: #333;">
        <ion-select-option value="All">All Matches</ion-select-option>
        <ion-select-option value="Tournament">Tournament Only</ion-select-option>
        <ion-select-option value="Friendly">Friendly Only</ion-select-option>
        <ion-select-option value="Live">Live Matches</ion-select-option>
        <ion-select-option value="Scheduled">Scheduled Matches</ion-select-option>
      </ion-select>
    </div>

    <!-- Empty State -->
    <div *ngIf="matches.length === 0" style="text-align: center; padding: 60px 20px;">
      <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
      <h3 style="color: #333; font-weight: 600; font-size: 18px; margin: 0 0 8px 0;">No Matches Found</h3>
      <p style="color: #666; font-size: 14px; margin: 0; line-height: 1.6;">
        No scheduled or live matches available.<br>
        Create a new match to get started!
      </p>
    </div>

    <!-- Matches List -->
    <div *ngIf="matches.length > 0">
      <div *ngFor="let match of matches" style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-top: 4px solid #1976d2;">
        
        <!-- Match Header -->
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
          <div>
            <h3 style="color: #1976d2; font-weight: 600; font-size: 16px; margin: 0 0 4px 0;">{{match.type}} Match</h3>
            <p style="color: #666; font-size: 13px; margin: 0;">ID: {{match.id.slice(-4)}} ‚Ä¢ {{match.matchDate}} ‚Ä¢ {{match.matchTime}}</p>
          </div>
          <div style="display: flex; gap: 8px;">
            <ion-badge *ngIf="match.status === 'in-progress'" style="--background: #ff5252; --color: white; font-size: 11px;">üî¥ Live</ion-badge>
            <ion-badge *ngIf="match.isCompleted" style="--background: #4caf50; --color: white; font-size: 11px;">‚úì Done</ion-badge>
          </div>
        </div>

        <!-- Venue -->
        <div style="background: #f5f5f5; padding: 12px; border-radius: 8px; margin-bottom: 12px; text-align: center;">
          <p style="color: #333; font-weight: 600; font-size: 15px; margin: 0;">{{match.venue}}</p>
        </div>

        <!-- Utility Buttons -->
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px;">
          <ion-button mode="ios" class="utility-btn" (click)="openOverlayControls(match)">
            <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
              <line x1="8" y1="21" x2="16" y2="21"/>
              <line x1="12" y1="17" x2="12" y2="21"/>
            </svg>
            Overlay
          </ion-button>
          <ion-button mode="ios" class="utility-btn">
            <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
              <path d="M23 7l-7 5 7 5V7z"/>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
            Stream
          </ion-button>
          <ion-button mode="ios" class="utility-btn">
            <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
              <circle cx="12" cy="12" r="1"/>
              <path d="M12 1v6m0 6v6"/>
              <path d="M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24"/>
              <path d="M1 12h6m6 0h6"/>
              <path d="M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"/>
            </svg>
            Control
          </ion-button>
        </div>

        <!-- Teams Section -->
        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 12px; align-items: center; margin-bottom: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
          <!-- Team 1 -->
          <div style="text-align: center;">
            <div style="width: 56px; height: 56px; margin: 0 auto 8px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.08);">
              <img [src]="match.team1.logo" 
                   style="width: 48px; height: 48px; object-fit: contain;" 
                   [alt]="match.team1.name"
                   onerror="this.src='assets/team-logo.png'">
            </div>
            <h4 style="margin: 0; font-weight: 600; font-size: 13px; color: #333;">{{match.team1.name}}</h4>
          </div>

          <!-- VS -->
          <div style="text-align: center;">
            <p style="color: #999; font-weight: 600; font-size: 12px; margin: 0; text-transform: uppercase;">VS</p>
          </div>

          <!-- Team 2 -->
          <div style="text-align: center;">
            <div style="width: 56px; height: 56px; margin: 0 auto 8px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.08);">
              <img [src]="match.team2.logo" 
                   style="width: 48px; height: 48px; object-fit: contain;" 
                   [alt]="match.team2.name"
                   onerror="this.src='assets/team-logo.png'">
            </div>
            <h4 style="margin: 0; font-weight: 600; font-size: 13px; color: #333;">{{match.team2.name}}</h4>
          </div>
        </div>

        <!-- Action Buttons -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          <ion-button mode="ios" class="primary-btn" (click)="startOrResumeScoring(match)">
            <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
              <circle cx="12" cy="12" r="10"/>
              <polygon points="10 8 16 12 10 16 10 8"/>
            </svg>
            Start Scoring
          </ion-button>
          <ion-button mode="ios" class="secondary-btn" (click)="closeMatch(match)">
            <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            Close Match
          </ion-button>
        </div>

        <!-- Scorecard Section -->
        <div *ngIf="match.firstInningsComplete || match.isCompleted" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0;">
          <h4 style="color: #333; font-weight: 600; font-size: 14px; margin: 0 0 12px 0; text-transform: uppercase; letter-spacing: 0.5px;">üìä Scorecard</h4>
          
          <!-- 1st Innings -->
          <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f5f5f5 100%); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #1976d2;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <p style="color: #1976d2; font-weight: 600; font-size: 13px; margin: 0;">{{getFirstInningsTeam(match)}}</p>
                <p style="color: #666; font-size: 12px; margin: 4px 0 0 0;">1st Innings</p>
              </div>
              <div style="text-align: right;">
                <p style="color: #333; font-weight: 700; font-size: 18px; margin: 0;">{{getFirstInningsScore(match)}}</p>
                <p style="color: #666; font-size: 12px; margin: 4px 0 0 0;">{{getFirstInningsOvers(match)}} overs</p>
              </div>
            </div>
          </div>

          <!-- 2nd Innings -->
          <div *ngIf="match.isSecondInnings || match.isCompleted" style="background: linear-gradient(135deg, #e8f5e9 0%, #f5f5f5 100%); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #4caf50;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <p style="color: #4caf50; font-weight: 600; font-size: 13px; margin: 0;">{{getSecondInningsTeam(match)}}</p>
                <p style="color: #666; font-size: 12px; margin: 4px 0 0 0;">2nd Innings</p>
              </div>
              <div style="text-align: right;">
                <p style="color: #333; font-weight: 700; font-size: 18px; margin: 0;">{{getSecondInningsScore(match)}}</p>
                <p style="color: #666; font-size: 12px; margin: 4px 0 0 0;">{{getSecondInningsOvers(match)}} overs</p>
              </div>
            </div>
          </div>

          <!-- Target Info -->
          <div *ngIf="match.isSecondInnings && !match.isCompleted" style="background: #fff8e1; padding: 12px; border-radius: 8px; border-left: 4px solid #fbc02d;">
            <p style="color: #f57f17; font-weight: 600; font-size: 13px; margin: 0 0 4px 0;">üéØ Target: {{getFirstInningsScore(match) + 1}} runs</p>
            <p style="color: #666; font-size: 12px; margin: 0;">Need {{getRunsNeeded(match)}} more runs to win</p>
          </div>
        </div>

        <!-- Match Result -->
        <div *ngIf="match.isCompleted" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); padding: 16px; border-radius: 8px; margin-top: 12px; text-align: center; color: white;">
          <p style="font-size: 24px; margin: 0 0 8px 0;">üèÜ</p>
          <h3 style="font-weight: 700; font-size: 16px; margin: 0 0 4px 0;">{{match.winner}} Wins!</h3>
          <p style="font-size: 13px; margin: 0 0 12px 0; opacity: 0.95;">{{match.resultDetails}}</p>
          <ion-button mode="ios" class="motm-btn" (click)="openManOfTheMatch(match)">
            <svg slot="start" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
              <path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/>
              <path d="M19.4 15a1.65 1.65 0 00.33-1.82l-.5-1.79a2 2 0 00-1.93-1.39h-.38a2 2 0 00-2 1.4 2 2 0 00-3.72 0 2 2 0 00-2-1.4h-.38a2 2 0 00-1.93 1.39l-.5 1.79A1.65 1.65 0 004.6 15"/>
            </svg>
            Man of the Match
          </ion-button>
        </div>

        <!-- Match Details Footer -->
        <div style="margin-top: 12px; padding: 12px; background: #f5f5f5; border-radius: 8px; font-size: 12px; color: #666;">
          <p style="margin: 0; line-height: 1.6;">
            <strong>Overs:</strong> {{match.numberOfOvers}} | 
            <strong>Ball:</strong> {{match.ballType}} | 
            <strong>Bowler Limit:</strong> {{match.bowlerOverLimit}} | 
            <strong>Status:</strong> {{match.status | titlecase}}
          </p>
          <p *ngIf="match.scorerEmail" style="margin: 8px 0 0 0;">
            <strong>Scorer:</strong> {{match.scorerEmail}}
          </p>
        </div>

      </div>
    </div>
  </div>
</ion-content>
